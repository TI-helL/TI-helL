# Quartz (Job Scheduler) Library Overview

- 작업 스케줄링 목적으로 사용
  - 작업을 <span style="color:red"><U>**어떤 시점에 실행할지**</U></span>에 집중
  - 표준 자바 컴포넌트로 정의된 작업에 대한 스케줄링
- 모든 자바 어플리케이션과 통합 가능
- JTA(Java Transaction API) 트랙잭션에 대한 참여, 클러스터링과 같은 엔터프라이즈급 기능 제공
  > JTA(Java Transaction API): 단일 DB나 다수의 DB를 이용할 때 플랫폼마다 다른 트랜잭션 매니저들과 어플리케이션들이 상호작용할 수 있는 인터페이스 정의
- 무료로 이용 가능 (Apache 2.0 라이센스)

<br>

## 목적

- 특정 시간에 수행되어야 하는 작업이나 시스템의 반복 작업에 대한 스케줄링
- Examples
  - 특정 주문이 처리됐는지를 <span style="color:red"><U>**주문 접수 2시간 이후 확인**</U></span>하고, 주문이 정상 처리되지 않았을 경우 주문의 상태를 "처리 요망"으로 변경하고 알림
  - DB를 XML 파일 형태로 <span style="color:red"><U>**매 영업일 밤 11시 30분**</U></span>에 덤프
  - 어플리케이션 내의 **리마인더** 서비스

<br>

## 실행 환경

- 다른 어플리케이션에 내장된 상태로 동작 가능
- 서블릿 컨테이너와 같은 어플리케이션 서버에서 인스턴스 형태로 동작 가능
  - 분산 트랜잭션(XA transaction) 참여도 가능
- JVM 내에서 단독 실행이 가능하고 RMI(Remote Method Invocation)을 통해 기능 사용 가능
- 단독 실행된 프로그램들로 클러스터링 가능(with load-balance, fail-over)

<br>

## 기능

<br>

### 1. 작업 스케줄링

- <span style="color:red"><U>**미리 정의한 트리거 이벤트가 발생했을 때 작업이 실행되도록 예약되는 방식**</U></span>
- 트리거는 아래처럼 여러 케이스들의 조합으로 만들 수 있음
  - 특정 시간에 동작 (밀리초 단위)
  - 그 주의 특정 요일에 동작
  - 그 달의 특정 요일에 동작
  - 그 해의 특정 일자에 동작
  - 등록된 캘린더의 특정 일자들은 제외 (ex. 영업 휴일)
  - 특정 횟수만큼 반복
  - 특정 시간이나 날짜까지 반복
  - 무기한 반복
  - 특정 시간이나 날짜 간격으로 반복
- 작업과 트리거는 지정한 이름으로 저장되며 다시 지정한 이름의 그룹으로 묶일 수 있음
- 작업은 하나의 스케줄러에만 추가할 수 있지만 다수의 트리거로 등록될 수 있음
- 엔터프라이즈 자바 환경에서 작업은 분산(XA) 트랜잭션의 일부로 동작할 수 있음

<br>

### 2. 작업 실행

- `Job` 인터페이스의 구현체는 모두 작업으로 취급 가능
- 트리거 이벤트가 발생하면 스케줄러는 `JobListener, TriggerListener` 인터페이스의 구현체들에 트리거 이벤트 발생 사실을 알리고, 작업실행 이후에는 작업실행에 대해 알림
- 작업이 완료될 때 해당 작업은 스케줄러에게 성공/실패 여부를 알리는 `JobCompletionCode`를 반환
  - 성공/실패 여부에 따라 어떤 액션을 취해야할지도 스케줄러에게 알림 (ex. 해당 작업을 즉시 재실행)

<br>

### 3. 작업 저장

- `JobStore` 인터페이스는 작업 저장의 다양한 방식을 정의함
- `JobStore` 구현체
  - `JDBCJobStore`를 이용하면 non-volatile로 설정된 모든 작업과 트리거가 JDBC를 통해 RDB에 저장됨
  - `RAMJobStore`를 이용하면 모든 작업과 트리거가 RAM에 저장됨
    - 프로그램 종료 시 사라짐
    - 외부 DB를 필요로하지 않는 이점이 있음

<br>

### 4. 트랜잭션

- Quartz는 `JDBCJobStore`의 하위 클래스인 `JobStoreCMT`를 통해 JTA 트랜잭션에 참여할 수 있음
- 작업 실행 시 Quartz가 JTA 트랜잭션을 관리(트랜잭션의 시작과 커밋) 가능
  - 해당 작업은 JTA 트랜잭션 내에서 자동으로 수행됨

<br>

### 5. 클러스터링

- Fail-over
- Load balancing
- Quartz 내장 클러스터링 기능은 `JDBCJobStore`를 이용한 DB 저장소에 의존함
- Terracotta의 Quartz 확장(extension)은 DB 없이 클러스터링할 수 있는 기능 제공

<br>

### 6. Listener와 플러그인

- 하나 이상의 Listener 인터페이스를 구현하면 스케줄링 관련 이벤트를 감지해서 작업/트리거의 동작을 제어하거나 모니터링할 수 있음
- 플러그인 메커니즘은 Quartz에 다른 기능을 추가하기 위해 사용
  - ex) 작업실행 이력 저장, 파일로부터 작업과 트리거의 정의 로딩
- Quartz는 다수의 플러그인과 Listener들을 함께 제공함

<br>

### 참고

- http://www.quartz-scheduler.org/
